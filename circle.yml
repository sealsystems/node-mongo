machine:
  timezone: Europe/Berlin

  environment:
    MONGO_VERSION: 3.6.2

  services:
    - docker

  node:
    version: 8.9.4

dependencies:
  pre: |
    sudo cp -r tls /etc

    sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2930ADAE8CAF5059EE73BB4B58712A2291FA4AD5
    echo "deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/${MONGO_VERSION%.*} multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-${MONGO_VERSION%.*}.list
    sudo apt-get update
    sudo apt-get install -y mongodb-org

    echo -e "
    systemLog:
      destination: file
      logAppend: true
      path: /var/log/mongodb/mongod.log

    storage:
      dbPath: /var/lib/mongodb
      mmapv1:
        smallFiles: true
      journal:
        enabled: false
      preallocDataFiles: false

    net:
      ssl:
        mode: requireSSL
        PEMKeyFile: /etc/tls/cert-key-combined.pem
    " | sudo tee /etc/mongod.conf

    sudo service mongod restart

test:
  override:
    - npm install -g roboter-cli
    - npm run bot
